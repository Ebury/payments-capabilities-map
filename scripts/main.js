!function n(e,t,o){function r(c,i){if(!t[c]){if(!e[c]){var l="function"==typeof require&&require;if(!i&&l)return l(c,!0);if(a)return a(c,!0);var s=new Error("Cannot find module '"+c+"'");throw s.code="MODULE_NOT_FOUND",s}var u=t[c]={exports:{}};e[c][0].call(u.exports,function(n){var t=e[c][1][n];return r(t?t:n)},u,u.exports,n,e,t,o)}return t[c].exports}for(var a="function"==typeof require&&require,c=0;c<o.length;c++)r(o[c]);return r}({1:[function(n,e,t){"use strict";function o(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),a=function(){function n(){o(this,n),this.container=document.querySelector(".js-map"),this.query="\n      SELECT world_borders.*, payments_and_capabilities.currency_name, payments_and_capabilities.currency_symbol, \n        payments_and_capabilities.payments, payments_and_capabilities.payments_in_local_currency, \n        payments_and_capabilities.collections_in_local_currency, payments_and_capabilities.cutoff_payment, \n        payments_and_capabilities.value_date_payment\n      FROM world_borders\n      LEFT JOIN payments_and_capabilities AS payments_and_capabilities\n        ON world_borders.iso_a3=payments_and_capabilities.country_iso_code\n      ORDER BY world_borders.labelrank;\n    ",this.cartocss="\n      #world_borders {\n        polygon-fill: #D9D9D9;\n        polygon-opacity: 1;\n        line-color: #FFF;\n        line-width: 0.5;\n        line-opacity: 1;\n      }\n      \n      #world_borders[{{ category_code }}=true] {\n        polygon-fill: #00BEF0;\n      }\n      \n      #world_borders::labels\n      [zoom > 3][labelrank < 3],\n      [zoom > 4][labelrank < 4],\n      [zoom > 5][labelrank < 5],\n      [zoom > 6][labelrank < 6],\n      [zoom > 7][labelrank < 7]\n      [zoom > 8][labelrank < 8]\n      [zoom > 9][labelrank < 9]\n      [zoom > 10][labelrank >= 9]\n      {\n        text-name: [name];\n        text-face-name: 'DejaVu Sans Book';\n        text-size: 10;\n        text-label-position-tolerance: 0;\n        text-fill: #000;\n        text-allow-overlap: false;\n        text-placement: point;\n        text-placement-type: simple;\n        text-placements: \"N,E,S,W\";\n      }\n    ",this.tooltipTemplate='\n      <div class="map__tooltip">\n        <h6 class="map__tooltip__title">{{ currency_name }}</h6>\n        <table class="map__tooltip__data">\n          <tbody>\n            {{#currency_symbol}}\n            <tr>\n              <td>Currency</td>\n              <td>{{ currency_symbol }}</td>\n            </tr>\n            {{/currency_symbol}}\n            <tr>\n              <td>Payments</td>\n              <td>{{#payments_in_local_currency}}Yes{{/payments_in_local_currency}}{{^payments_in_local_currency}}No{{/payments_in_local_currency}}</td>\n            </tr>\n            <tr>\n              <td>Collections</td>\n              <td>{{#collections_in_local_currency}}Yes{{/collections_in_local_currency}}{{^collections_in_local_currency}}No{{/collections_in_local_currency}}</td>\n            </tr>    \n            {{#cutoff_payment}}\n            <tr>\n              <td>Cut off</td>\n              <td>{{ cutoff_payment }}</td>\n            </tr>\n            {{/cutoff_payment}}\n            {{#value_date_payment}}\n            <tr>\n              <td>Value date</td>\n              <td>{{ value_date_payment }}</td>\n            </tr>\n            {{/value_date_payment}}\n          </tbody>  \n        </table>\n      </div>\n      ';var e="payments",t="payments_in_local_currency",r="collections_in_local_currency";this.categories=[{code:e},{code:t},{code:r}],this.currentCategory=_.findWhere(this.categories,{code:e}),this.configureSize(),this.createMap(),this.addCartoLayer(),this.handleCategoryChange()}return r(n,[{key:"configureSize",value:function(){var n=this,e=[{minScreenWidth:1200,center:[30,0],zoom:3},{minScreenWidth:992,center:[30,0],zoom:2},{minScreenWidth:768,center:[30,0],zoom:2},{minScreenWidth:0,center:[30,0],zoom:1}];e.some(function(e){var t=$(window).width();if(t>=e.minScreenWidth)return n.options=e,!0})}},{key:"createMap",value:function(){this.map=new L.Map(this.container,{center:this.options.center,zoom:this.options.zoom,minZoom:this.options.zoom,zoomControl:!1,scrollWheelZoom:!1,attributionControl:!1}),L.control.zoom({position:"topright"}).addTo(this.map)}},{key:"resetZoom",value:function(){this.map.setView(new L.LatLng(this.options.center[0],this.options.center[1]),this.options.zoom)}},{key:"addCartoLayer",value:function(){var n=this;cartodb.createLayer(this.map,{user_name:"ebury",type:"cartodb",sublayers:[{sql:this.query,cartocss:this.cartocss.replace("{{ category_code }}",this.currentCategory.code),interactivity:"currency_name, currency_symbol, payments, payments_in_local_currency, collections_in_local_currency, cutoff_payment, cartodb_id, iso_a3, value_date_payment, name"}]},{https:!0}).addTo(this.map).on("done",function(e){n.cartoLayer=e.getSubLayer(0),n.addTooltip(e),n.handleCountryClick()})}},{key:"addTooltip",value:function(n){var e=this,t=n.leafletMap.viz.addOverlay({type:"tooltip",layer:this.cartoLayer,template:this.tooltipTemplate,position:"top|center",fields:[{currency_name:"currency_name",currency_symbol:"currency_symbol",payments_in_local_currency:"payments_in_local_currency",collections_in_local_currency:"collections_in_local_currency",cutoff_payment:"cutoff_payment",value_date_payment:"value_date_payment"}]});this.cartoLayer.off("mouseover").on("mouseover",function(n,o,r,a){a[e.currentCategory.code]&&(t.show(r,a),t.showing=!0)})}},{key:"handleCountryClick",value:function(){var n=this;this.countryInfo=new Vue({el:".js-country-info",data:{countryName:null,currencyName:null,currencySymbol:null,paymentsInLocalCurrency:null,collectionsInLocalCurrency:null,cutoff:null,valueDate:null,info:null}}),this.cartoLayer.on("mouseover",function(e,t,o,r){r[n.currentCategory.code]?n.container.style.cursor="pointer":n.container.style.cursor=""}).on("mouseout",function(){n.container.style.cursor=""}).on("featureClick",function(e,t,o,r){r[n.currentCategory.code]&&n.showCountryInfo(r.name,r.iso_a3)})}},{key:"showCountryInfo",value:function(n,e){var t=this,o=new cartodb.SQL({user:"ebury"}),r=$(this.countryInfo.$el);r.addClass("country-info--loading"),o.execute("SELECT * FROM payments_and_capabilities WHERE country_iso_code = '{{country}}'",{country:e}).done(function(e){t.countryInfo.countryName=n,t.countryInfo.currencyName=e.rows[0].currency_name,t.countryInfo.currencySymbol=e.rows[0].currency_symbol,t.countryInfo.paymentsInLocalCurrency=e.rows[0].payments_in_local_currency,t.countryInfo.collectionsInLocalCurrency=e.rows[0].collections_in_local_currency,t.countryInfo.cutoff=e.rows[0].cutoff_payment,t.countryInfo.valueDate=e.rows[0].value_date_payment,t.countryInfo.info=e.rows[0].info,r.modal("show"),r.removeClass("country-info--loading")}).error(function(n){console.log("errors:"+n)})}},{key:"handleCategoryChange",value:function(){var n=this;$(".js-category").on("change",function(e){return n.changeCategory($(e.currentTarget).val())})}},{key:"changeCategory",value:function(n){this.resetZoom(),this.currentCategory=_.findWhere(this.categories,{code:n}),this.cartoLayer.setCartoCSS(this.cartocss.replace("{{ category_code }}",this.currentCategory.code))}}]),n}();new a},{}]},{},[1]);