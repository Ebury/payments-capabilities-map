!function e(t,o,n){function r(c,i){if(!o[c]){if(!t[c]){var l="function"==typeof require&&require;if(!i&&l)return l(c,!0);if(a)return a(c,!0);var s=new Error("Cannot find module '"+c+"'");throw s.code="MODULE_NOT_FOUND",s}var u=o[c]={exports:{}};t[c][0].call(u.exports,function(e){var o=t[c][1][e];return r(o?o:e)},u,u.exports,e,t,o,n)}return o[c].exports}for(var a="function"==typeof require&&require,c=0;c<n.length;c++)r(n[c]);return r}({1:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this.container=document.querySelector(".js-map"),this.query="\n      SELECT world_borders.*, payments_and_capabilities.currency_name, payments_and_capabilities.currency_symbol, \n        payments_and_capabilities.payments, payments_and_capabilities.collections, payments_and_capabilities.cutoff, \n        payments_and_capabilities.category, payments_and_capabilities.value_date\n      FROM world_borders\n      LEFT JOIN payments_and_capabilities\n        ON world_borders.iso_a3=payments_and_capabilities.country_iso_code\n      WHERE world_borders.iso_a3 != 'ATA'\n      ORDER BY world_borders.labelrank;\n    ",this.cartocss="\n      #world_borders{\n        polygon-fill: #D9D9D9;\n        polygon-opacity: 1;\n        line-color: #FFF;\n        line-width: 0.5;\n        line-opacity: 1;\n      }\n      \n      #world_borders[category={{ category_code }}]{\n        polygon-fill: {{ category_color }};\n      }\n      \n      #world_borders::labels\n      [zoom > 3][labelrank < 3],\n      [zoom > 4][labelrank < 4],\n      [zoom > 5][labelrank < 5],\n      [zoom > 6][labelrank < 6],\n      [zoom > 7][labelrank < 7]\n      [zoom > 8][labelrank < 8]\n      [zoom > 9][labelrank < 9]\n      [zoom > 10][labelrank >= 9]\n      {\n        text-name: [name];\n        text-face-name: 'DejaVu Sans Book';\n        text-size: 10;\n        text-label-position-tolerance: 0;\n        text-fill: #000;\n        text-allow-overlap: false;\n        text-placement: point;\n        text-placement-type: simple;\n        text-placements: \"N,E,S,W\";\n      }\n    ",this.tooltipTemplate='\n      <div class="map__tooltip">\n        <h6 class="map__tooltip__title">{{ currency_name }}</h6>\n        <table class="map__tooltip__data">\n          <tbody>\n            <tr>\n              <td>Currency</td>\n              <td>{{ currency_symbol }}</td>\n            </tr>\n            <tr>\n              <td>Payments</td>\n              <td>{{#payments}}Yes{{/payments}}{{^payments}}No{{/payments}}</td>\n            </tr>\n           <tr>\n              <td>Collections</td>\n              <td>{{#collections}}Yes{{/collections}}{{^collections}}No{{/collections}}</td>\n            </tr>           \n            <tr>\n              <td>Cut off</td>\n              <td>{{ cutoff }}</td>\n            </tr>\n            <tr>\n              <td>Value date</td>\n              <td>{{ value_date }}</td>\n            </tr>\n          </tbody>  \n        </table>\n      </div>\n      ';var t=1,o=2,r=3;this.categories=[{code:t,color:"#00C0F0"},{code:o,color:"#9AD7E5"},{code:r,color:"#144257"}],this.currentCategory=_.findWhere(this.categories,{code:t}),this.configureSize(),this.createMap(),this.addCartoLayer(),this.handleCategoryChange()}return r(e,[{key:"configureSize",value:function(){var e=this,t=[{minScreenWidth:1200,center:[30,0],zoom:3},{minScreenWidth:992,center:[30,0],zoom:2},{minScreenWidth:768,center:[30,0],zoom:2},{minScreenWidth:0,center:[30,0],zoom:1}];t.some(function(t){var o=$(window).width();if(o>=t.minScreenWidth)return e.options=t,!0})}},{key:"createMap",value:function(){this.map=new L.Map(this.container,{center:this.options.center,zoom:this.options.zoom,minZoom:this.options.zoom,zoomControl:!1,scrollWheelZoom:!1,attributionControl:!1}),L.control.zoom({position:"topright"}).addTo(this.map)}},{key:"resetZoom",value:function(){this.map.setView(new L.LatLng(this.options.center[0],this.options.center[1]),this.options.zoom)}},{key:"addCartoLayer",value:function(){var e=this;cartodb.createLayer(this.map,{user_name:"ebury",type:"cartodb",sublayers:[{sql:this.query,cartocss:this.cartocss.replace("{{ category_code }}",this.currentCategory.code).replace("{{ category_color }}",this.currentCategory.color),interactivity:"currency_name, currency_symbol, payments, collections, cutoff, category, cartodb_id, iso_a3, value_date, name"}]},{https:!0}).addTo(this.map).on("done",function(t){e.cartoLayer=t.getSubLayer(0),e.addTooltip(t),e.handleCountryClick()})}},{key:"addTooltip",value:function(e){var t=this,o=e.leafletMap.viz.addOverlay({type:"tooltip",layer:this.cartoLayer,template:this.tooltipTemplate,position:"top|center",fields:[{currency_name:"currency_name",currency_symbol:"currency_symbol",payments:"payments",collections:"collections",cutoff:"cutoff",category:"category",value_date:"value_date"}]});this.cartoLayer.off("mouseover").on("mouseover",function(e,n,r,a){a.category===t.currentCategory.code&&(o.show(r,a),o.showing=!0)})}},{key:"handleCountryClick",value:function(){var e=this;this.countryInfo=new Vue({el:".js-country-info",data:{countryName:null,currencyName:null,currencySymbol:null,payments:null,collections:null,cutoff:null,valueDate:null,info:null}}),this.cartoLayer.on("mouseover",function(t,o,n,r){r.category===e.currentCategory.code?e.container.style.cursor="pointer":e.container.style.cursor=""}).on("mouseout",function(){e.container.style.cursor=""}).on("featureClick",function(t,o,n,r){r.category===e.currentCategory.code&&e.showCountryInfo(r.name,r.iso_a3)})}},{key:"showCountryInfo",value:function(e,t){var o=this,n=new cartodb.SQL({user:"ebury"}),r=$(this.countryInfo.$el);r.addClass("country-info--loading"),n.execute("SELECT * FROM payments_and_capabilities WHERE country_iso_code = '{{country}}'",{country:t}).done(function(t){o.countryInfo.countryName=e,o.countryInfo.currencyName=t.rows[0].currency_name,o.countryInfo.currencySymbol=t.rows[0].currency_symbol,o.countryInfo.payments=t.rows[0].payments,o.countryInfo.collections=t.rows[0].collections,o.countryInfo.cutoff=t.rows[0].cutoff,o.countryInfo.valueDate=t.rows[0].value_date,o.countryInfo.info=t.rows[0].info,r.modal("show"),r.removeClass("country-info--loading")}).error(function(e){console.log("errors:"+e)})}},{key:"handleCategoryChange",value:function(){var e=this;$(".js-category").on("change",function(t){return e.changeCategory(parseInt($(t.currentTarget).val()))})}},{key:"changeCategory",value:function(e){this.resetZoom(),this.currentCategory=_.findWhere(this.categories,{code:e}),this.cartoLayer.setCartoCSS(this.cartocss.replace("{{ category_code }}",this.currentCategory.code).replace("{{ category_color }}",this.currentCategory.color))}}]),e}();new a},{}]},{},[1]);